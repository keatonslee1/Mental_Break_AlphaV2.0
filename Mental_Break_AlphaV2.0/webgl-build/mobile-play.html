<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mental Break Â· Mobile Play</title>

    <link rel="icon" type="image/png" href="TemplateData/favicon-48x48.png" />
    <link rel="stylesheet" href="TemplateData/style.css?v=2.1" />

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #000;
      }

      body {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
      }

      #unity-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        overflow: hidden;
      }

      #unity-canvas {
        background: #000;
        display: block;
        touch-action: none;
      }

      #unity-loading-bar {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      #unity-warning {
        position: absolute;
        left: 50%;
        top: 10px;
        transform: translateX(-50%);
        color: #fff;
        font-family: sans-serif;
        font-size: 14px;
        text-align: center;
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 6px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"></div>
    </div>

    <script>
      const UNITY_BASE_WIDTH = 960;
      const UNITY_BASE_HEIGHT = 600;
      const UNITY_ASPECT = UNITY_BASE_WIDTH / UNITY_BASE_HEIGHT;

      const canvas = document.querySelector("#unity-canvas");
      const unityContainer = document.querySelector("#unity-container");
      const loadingBar = document.querySelector("#unity-loading-bar");
      const progressBarFull = document.querySelector("#unity-progress-bar-full");

      function resizeCanvas() {
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        if (unityContainer) {
          unityContainer.style.width = `${vw}px`;
          unityContainer.style.height = `${vh}px`;
        }

        let targetWidth = vw;
        let targetHeight = targetWidth / UNITY_ASPECT;

        if (targetHeight > vh) {
          targetHeight = vh;
          targetWidth = targetHeight * UNITY_ASPECT;
        }

        canvas.style.width = `${targetWidth}px`;
        canvas.style.height = `${targetHeight}px`;

        const pixelRatio = window.devicePixelRatio || 1;
        canvas.width = Math.max(1, Math.floor(targetWidth * pixelRatio));
        canvas.height = Math.max(1, Math.floor(targetHeight * pixelRatio));
      }

      resizeCanvas();

      window.addEventListener("resize", resizeCanvas);
      window.addEventListener("orientationchange", resizeCanvas);
      if (window.visualViewport) {
        window.visualViewport.addEventListener("resize", resizeCanvas);
        window.visualViewport.addEventListener("scroll", resizeCanvas);
      }

      function unityShowBanner(msg, type) {
        const warningBanner = document.querySelector("#unity-warning");
        warningBanner.style.display = "block";
        warningBanner.textContent = msg;
        if (type === "error") {
          warningBanner.style.background = "rgba(255, 51, 102, 0.85)";
        } else {
          warningBanner.style.background = "rgba(255, 170, 0, 0.85)";
          setTimeout(() => {
            warningBanner.style.display = "none";
          }, 5000);
        }
      }

      const buildUrl = "Build";
      const loaderUrl = `${buildUrl}/webgl-build.loader.js`;
      const config = {
        arguments: [],
        dataUrl: `${buildUrl}/webgl-build.data.unityweb`,
        frameworkUrl: `${buildUrl}/webgl-build.framework.js.unityweb`,
        codeUrl: `${buildUrl}/webgl-build.wasm.unityweb`,
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Keaton Media",
        productName: "Mental Break",
        productVersion: "3.1",
        showBanner: unityShowBanner,
        devicePixelRatio: 1,
        matchWebGLToCanvasSize: true,
      };

      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (isIOS) {
        config.webglContextAttributes = {
          powerPreference: "low-power",
          antialias: false,
          depth: true,
          stencil: false,
          alpha: false,
          preserveDrawingBuffer: false,
        };
      }

      function showLoading(progress) {
        if (loadingBar) loadingBar.style.display = "block";
        if (progressBarFull) progressBarFull.style.width = `${progress * 100}%`;
      }

      function hideLoading() {
        if (loadingBar) loadingBar.style.display = "none";
      }

      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        resizeCanvas();
        createUnityInstance(canvas, config, showLoading)
          .then((unityInstance) => {
            hideLoading();
            resizeCanvas();
            window.unityInstance = unityInstance;
          })
          .catch((message) => {
            hideLoading();
            console.error("[Unity Web] Failed to load game", message);
            const reason =
              typeof message === "string" ? message : message?.message || "Unknown error";
            unityShowBanner(`Failed to load game: ${reason}`, "error");
          });
      };
      script.onerror = () => {
        unityShowBanner(
          "Failed to load Unity loader script. Please check your connection and try again.",
          "error"
        );
      };
      document.body.appendChild(script);
    </script>
  </body>
</html>
